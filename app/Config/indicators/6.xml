<indicators>
    <indicator id="6">
        <subgroups>
            <item name="All Ages" type="Age" order="1" reference="Population">
                <mysql>
                    <where>
                        <![CDATA[
						AND `population`.`age` = {KEY}
					]]>
                    </where>
                </mysql>
            </item>
            <item name="All Sex" type="Sex" order="2">
                <mysql>
                    <select>
                        <![CDATA[
						SUM(`main_data`.`total`) AS `data_value`,
						SUM(`main_data`.`total`) AS `numerator`,
					]]>
                    </select>
                </mysql>
            </item>
            <item name="Male" type="Sex" order="2">
                <mysql>
                    <select>
                        <![CDATA[
						SUM(`main_data`.`male`) AS `data_value`,
						SUM(`main_data`.`male`) AS `numerator`,
					]]>
                    </select>
                </mysql>
            </item>
            <item name="Female" type="Sex" order="2">
                <mysql>
                    <select>
                        <![CDATA[
						SUM(`main_data`.`female`) AS `data_value`,
						SUM(`main_data`.`female`) AS `numerator`,
					]]>
                    </select>
                </mysql>
            </item>

        </subgroups>
        <query>
            <mysql>
                <insert>
                    <![CDATA[
                        INSERT INTO `batch_indicator_results`
                        SELECT
                        NULL,
                        -- {INDICATOR_ID} AS `batch_indicator_id`,
                        -- {SUBGROUPS} AS `subgroups`,
                        `main_data`.`area_id`,
                        `main_data`.`year` AS `timeperiod`,
                        -- {SELECT}
                        NULL AS `denominator`,
                        `main_data`.`classification`,
                        -- {USER_ID},
                        NOW()

                        FROM (
                            SELECT
                                `population`.`area_id`,
                                CONCAT('Population - ', `population`.`source`) AS `classification`,
                                `population`.`age`,
                                `population`.`year`,
                                SUM(`population`.`male`) AS `male`,
                                SUM(`population`.`female`) AS `female`,
                                SUM(`population`.`male`) + SUM(`population`.`female`) AS `total`
                            FROM `population`
                            -- {WHERE}

                            GROUP BY
                            -- {GROUP}
                            `population`.`area_id`,
                            `population`.`age`,
                            `population`.`year`
                        ) AS `main_data`

                        GROUP BY
                        `main_data`.`year`,
                        `main_data`.`area_id`,
                        `main_data`.`classification`
				]]>
                </insert>
            </mysql>
        </query>

    </indicator>
</indicators>